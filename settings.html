<!-- SillyTavern RAG Extension Settings -->
<div id="rag-settings" class="rag-container">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <div class="flex-container alignitemscenter margin0">
                <b>RAG Extension</b>
                <div class="rag-status">
                    <span>Service Status:</span>
                    <span id="rag-service-status" class="rag-status-indicator rag-status-disconnected"></span>
                </div>
            </div>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <div id="ragExtensionDrawerContents">
                <div class="rag-section">
                    <h3>Add Memory</h3>
                    <textarea id="rag-add-memory-input" class="text_pole" rows="3" placeholder="Enter text to add as a memory..."></textarea>
                    <button id="rag-add-memory-button" class="menu_button">Add Memory</button>
                </div>

                <div class="rag-section">
                    <h3>Query Memories</h3>
                    <textarea id="rag-query-input" class="text_pole" rows="3" placeholder="Enter text to find relevant memories..."></textarea>
                    <button id="rag-query-button" class="menu_button">Query</button>
                </div>

                <div class="rag-section">
                    <h3>Results</h3>
                    <div id="rag-results-container" class="rag-results">
                        <p>Query results will be displayed here.</p>
                    </div>
                </div>
                
                <div class="rag-section">
                    <h3>System Status</h3>
                    <p>Service Status: <span id="rag-service-status" class="rag-status-indicator rag-status-disconnected"></span></p>
                    <p>Tokens in Last Query: <span id="rag-last-query-tokens">0</span></p>
                </div>

                <div class="rag-section">
                    <h3>Reranking Configuration</h3>
                    <div class="rag-config-item">
                        <label for="rag-fast-rerank-count">Fast Rerank Count (rerank_fast_top_n):</label>
                        <input type="number" id="rag-fast-rerank-count" class="text_pole" value="100" min="1">
                        <small>Number of memories to pass to the strong reranker (default: 100)</small>
                    </div>
                    <div class="rag-config-item">
                        <label for="rag-final-memory-count">Final Memory Count (final_top_n):</label>
                        <input type="number" id="rag-final-memory-count" class="text_pole" value="10" min="1">
                        <small>Maximum number of memories to return (default: 10)</small>
                    </div>
                </div>



                <div class="rag-section">
                    <h3>SillyTavern Integration</h3>
                    <div class="rag-config-item">
                        <label>
                            <input type="checkbox" id="rag-auto-memory" checked>
                            Auto-add messages to memory
                        </label>
                        <small>Automatically add user and assistant messages to memory when they are sent/received</small>
                    </div>
                    <div class="rag-config-item">
                        <label>
                            <input type="checkbox" id="rag-context-integration" checked>
                            Inject memories into AI context
                        </label>
                        <small>Automatically inject relevant memories into the AI's system prompt during generation</small>
                    </div>
                    <div class="rag-config-item">
                        <label>
                            <input type="checkbox" id="rag-recent-messages" checked>
                            Include recent messages in context
                        </label>
                        <small>Add the last 10 messages to the AI context for better continuity</small>
                    </div>
                </div>

                <div class="rag-section">
                    <h3>Debug & Utilities</h3>
                    <div class="rag-config-item">
                        <button id="rag-debug-button" class="menu_button">Debug: Add Last Message</button>
                        <small>Manually add the latest message to memory (for testing)</small>
                    </div>
                    <div class="rag-config-item">
                        <button id="rag-sync-button" class="menu_button">Sync Chat History</button>
                        <small>Add all messages from current chat to memory (one-time bulk operation)</small>
                    </div>
                </div>

                <div class="rag-section">
                    <h3>Memory Management</h3>
                    <div class="rag-config-item">
                        <button id="rag-delete-chat-memories" class="menu_button" style="background-color: #d32f2f; color: white;">Delete Current Chat Memories</button>
                        <small>Delete all memories from the current chat only</small>
                    </div>
                    <div class="rag-config-item">
                        <button id="rag-delete-all-memories" class="menu_button" style="background-color: #b71c1c; color: white;">Delete ALL Memories</button>
                        <small>⚠️ WARNING: This will delete ALL memories from ALL chats permanently!</small>
                    </div>
                </div>

                <div class="rag-section">
                    <h3>Memory Statistics</h3>
                    <div class="rag-config-item">
                        <p>Current Chat Memories: <span id="rag-current-chat-memories" class="rag-count">0</span></p>
                        <small>Number of memories for the current character and chat</small>
                    </div>
                    <div class="rag-config-item">
                        <p>All Memories: <span id="rag-all-memories-count" class="rag-count">0</span></p>
                        <small>Total number of memories across all characters and chats</small>
                    </div>
                </div>
                <hr class="sysHR">
            </div>
        </div>
    </div>
</div>